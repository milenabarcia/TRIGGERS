-- Criando tabela exemplo2 --

CREATE TABLE Filmes (
ID  INT  AUTO_INCREMENT PRIMARY KEY,
Titulo VARCHAR (60),
Minutos int
);

DELIMITER //
CREATE TRIGGER chk_minutos BEFORE INSERT ON Filmes
FOR EACH ROW
BEGIN
   IF NEW.Minutos < 0 then
   set new.minutos = null;
   end if;
   END//
   DELIMITER ;

INSERT INTO Filmes (Titulo, Minutos) VALUES ("The terrible trigger", 120);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("O Alto da compadecida", 135);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("Faroeste Caboclo", 240);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("The Matrix", 90);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("Blade runner", -88);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("O labirinto do fauno", 110);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("Metropole", 0);
INSERT INTO Filmes (Titulo, Minutos) VALUES ("A lista", 120);

DELIMITER $
CREATE TRIGGER chk_minuto BEFORE INSERT ON Filmes
FOR EACH ROW
BEGIN
   IF NEW.Minutos < 0 then
   
   -- Lançar um Erro-
   signal SQLSTATE '45000'     -- exeção não tratada--
   set MESSAGE_TEXT = "valor imválido para minutos",
   MYSQL_ERRNO = 2022;   -- código de controle --
   
   end if;
   END$
   
   DELIMITER ; 
   
   CREATE TABLE Log_deletions (
   ID     INT AUTO_INCREMENT PRIMARY KEY,
   Titulo VARCHAR(60),
   Quando DateTime,
   Quem   VARCHAR (40)
   );
   
   DELIMITER $
   CREATE TRIGGER lod_deletions AFTER DELETE ON Filmes
   for each row
   begin
   INSERT INTO Log_deletions VALUES (null, old.titulo, sysdate(), user());
   end$
   DELIMITER ;
   
   delete from Filmes where id = 2;
   delete from Filmes where id = 4;
   
   SELECT*FROM Log_deletions;
